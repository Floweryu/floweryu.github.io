<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.68" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-beta.250" />
    <style>
      html {
        background: #fff;
      }

      html[data-theme="dark"] {
        background: #1d1e1f;
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://floweryu.top/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html"><meta property="og:site_name" content="Floweryu"><meta property="og:title" content="Spring动态AOP原理"><meta property="og:description" content="一.. 引入 1.1 概念 image-20221130195504431 1.2 注解方式使用AOP 1.3 xml方式使用AOP 1.4 抛出问题？ a. Advice的执行顺序？ image-20221130214127496 xml执行后输出 image-20221130214215063 注解方式执行后输出 对比上面两张图片，可以看到@Aro..."><meta property="og:type" content="article"><meta property="og:image" content="https://floweryu.top/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-12-29T07:05:50.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Spring动态AOP原理"><meta property="article:author" content="Floweryu"><meta property="article:tag" content="后端"><meta property="article:published_time" content="2023-12-29T15:30:00.000Z"><meta property="article:modified_time" content="2023-12-29T07:05:50.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring动态AOP原理","image":["https://floweryu.top/"],"datePublished":"2023-12-29T15:30:00.000Z","dateModified":"2023-12-29T07:05:50.000Z","author":[{"@type":"Person","name":"Floweryu","url":"https://github.com/Floweryu/floweryu.github.io","email":"869830837@qq.com"}]}</script><link rel="icon" href="/logo.png"><title>Spring动态AOP原理 | Floweryu</title><meta name="description" content="一.. 引入 1.1 概念 image-20221130195504431 1.2 注解方式使用AOP 1.3 xml方式使用AOP 1.4 抛出问题？ a. Advice的执行顺序？ image-20221130214127496 xml执行后输出 image-20221130214215063 注解方式执行后输出 对比上面两张图片，可以看到@Aro...">
    <link rel="preload" href="/assets/style-dffa5771.css" as="style"><link rel="stylesheet" href="/assets/style-dffa5771.css">
    <link rel="modulepreload" href="/assets/app-3981ffce.js"><link rel="modulepreload" href="/assets/Spring的动态AOP原理.html-036cb194.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/Spring的动态AOP原理.html-3ec9b0b5.js">
    <link rel="prefetch" href="/assets/index.html-24ee2c98.js" as="script"><link rel="prefetch" href="/assets/LRU缓存算法.html-009cfdd0.js" as="script"><link rel="prefetch" href="/assets/二分查找专题.html-10cdd55c.js" as="script"><link rel="prefetch" href="/assets/二叉树专题.html-9ae390ea.js" as="script"><link rel="prefetch" href="/assets/剑指offer专题.html-69e0d802.js" as="script"><link rel="prefetch" href="/assets/动态规划专题.html-5109b367.js" as="script"><link rel="prefetch" href="/assets/双指针专题.html-c6a6096b.js" as="script"><link rel="prefetch" href="/assets/常用算法积累.html-c57ed3c5.js" as="script"><link rel="prefetch" href="/assets/排序专题.html-7d558620.js" as="script"><link rel="prefetch" href="/assets/排序算法及其时间复杂度.html-f953721a.js" as="script"><link rel="prefetch" href="/assets/栈和队列专题.html-ff2931a2.js" as="script"><link rel="prefetch" href="/assets/红黑树详解.html-641ceb4a.js" as="script"><link rel="prefetch" href="/assets/递归回溯专题.html-c30907b4.js" as="script"><link rel="prefetch" href="/assets/链表专题.html-f19b4d43.js" as="script"><link rel="prefetch" href="/assets/如何设计秒杀架构.html-9012b01d.js" as="script"><link rel="prefetch" href="/assets/缓存一致性方案思考.html-e21cb7db.js" as="script"><link rel="prefetch" href="/assets/Dubbo超时时间原理.html-536aa9a4.js" as="script"><link rel="prefetch" href="/assets/B_树索引原理.html-2f6ab2fc.js" as="script"><link rel="prefetch" href="/assets/Buffer Pool缓冲池作用.html-cfd41963.js" as="script"><link rel="prefetch" href="/assets/LIMIT分页优化查询.html-aad4e7ea.js" as="script"><link rel="prefetch" href="/assets/MySQL一行记录如何存储.html-2e2295e5.js" as="script"><link rel="prefetch" href="/assets/MySQL日志详解.html-f1bfa67c.js" as="script"><link rel="prefetch" href="/assets/MySQL索引详解.html-16c7e5b8.js" as="script"><link rel="prefetch" href="/assets/MySQL锁那些事.html-1378d694.js" as="script"><link rel="prefetch" href="/assets/事务隔离级别的实现.html-f32f26dc.js" as="script"><link rel="prefetch" href="/assets/Redis主从复制机制.html-57e63d1d.js" as="script"><link rel="prefetch" href="/assets/Redis哨兵模式.html-d0e21a54.js" as="script"><link rel="prefetch" href="/assets/Redis持久化.html-24cbbfbf.js" as="script"><link rel="prefetch" href="/assets/Redis数据结构与对象.html-77ae801a.js" as="script"><link rel="prefetch" href="/assets/Redis线程模型.html-2d17ac37.js" as="script"><link rel="prefetch" href="/assets/Redis过期删除和内存淘汰.html-dd31520d.js" as="script"><link rel="prefetch" href="/assets/Redis面试题集锦.html-28eb663a.js" as="script"><link rel="prefetch" href="/assets/缓存击穿、缓存穿透、缓存雪崩.html-ac3a89cb.js" as="script"><link rel="prefetch" href="/assets/跳表SkipList原理.html-12646f8e.js" as="script"><link rel="prefetch" href="/assets/MQ简介.html-8d824a9c.js" as="script"><link rel="prefetch" href="/assets/RocketMQ框架基础设计.html-cb1222c1.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——事务消息.html-eea5b9a1.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——服务发现.html-bba1ce28.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——消息存储.html-99b9f84b.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——通信模块.html-b7a37315.js" as="script"><link rel="prefetch" href="/assets/RocketMQ的事务消息.html-6964440b.js" as="script"><link rel="prefetch" href="/assets/RocketMQ面试题.html-3ea5ea91.js" as="script"><link rel="prefetch" href="/assets/延时发送消息.html-c5d38328.js" as="script"><link rel="prefetch" href="/assets/批量发送消息及消息列表分割.html-46f763dc.js" as="script"><link rel="prefetch" href="/assets/消息发送与消费.html-87cd85c2.js" as="script"><link rel="prefetch" href="/assets/消息类型.html-58346830.js" as="script"><link rel="prefetch" href="/assets/消息过滤.html-01511a16.js" as="script"><link rel="prefetch" href="/assets/顺序消费.html-c1dfc838.js" as="script"><link rel="prefetch" href="/assets/Sentinel基础概念.html-1190bdad.js" as="script"><link rel="prefetch" href="/assets/Sentinel流量控制.html-27c83903.js" as="script"><link rel="prefetch" href="/assets/Sentinel熔断降级.html-2e99b0e8.js" as="script"><link rel="prefetch" href="/assets/Sentinel限流原理.html-d3c164f9.js" as="script"><link rel="prefetch" href="/assets/Sentinel集群流控.html-58831333.js" as="script"><link rel="prefetch" href="/assets/ConfigurationClassPostProcessor源码理解.html-31608c23.js" as="script"><link rel="prefetch" href="/assets/Spring中Bean的作用域scope.html-028815b3.js" as="script"><link rel="prefetch" href="/assets/Spring如何解决循环依赖.html-ead9a007.js" as="script"><link rel="prefetch" href="/assets/Spring执行BeanFactoryPostProcessor源码理解.html-27f1759d.js" as="script"><link rel="prefetch" href="/assets/Spring自定义扩展.html-7a2bf6b9.js" as="script"><link rel="prefetch" href="/assets/Comparator比较器返回值理解.html-c2d2ba67.js" as="script"><link rel="prefetch" href="/assets/Java反射.html-1a850d2a.js" as="script"><link rel="prefetch" href="/assets/Java的__和equals()的区别.html-40726313.js" as="script"><link rel="prefetch" href="/assets/Java的SPI机制.html-037e0831.js" as="script"><link rel="prefetch" href="/assets/Transactional注解原理.html-302486aa.js" as="script"><link rel="prefetch" href="/assets/深入理解Java序列化.html-75f23080.js" as="script"><link rel="prefetch" href="/assets/JVM参数详解.html-2c69481b.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收器.html-24bd23e6.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收基础.html-0615da52.js" as="script"><link rel="prefetch" href="/assets/AQS源码理解——ReentrantLock.html-3bb4866a.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal详解.html-0d70e02d.js" as="script"><link rel="prefetch" href="/assets/同步器原理及使用场景.html-91f90b6d.js" as="script"><link rel="prefetch" href="/assets/404.html-ee1810e3.js" as="script"><link rel="prefetch" href="/assets/index.html-e6d489bb.js" as="script"><link rel="prefetch" href="/assets/index.html-f0f13ceb.js" as="script"><link rel="prefetch" href="/assets/index.html-909c2daf.js" as="script"><link rel="prefetch" href="/assets/index.html-51fadf9d.js" as="script"><link rel="prefetch" href="/assets/index.html-0cce731a.js" as="script"><link rel="prefetch" href="/assets/index.html-14344404.js" as="script"><link rel="prefetch" href="/assets/index.html-4405c49a.js" as="script"><link rel="prefetch" href="/assets/index.html-4a49be9b.js" as="script"><link rel="prefetch" href="/assets/index.html-4719d7ea.js" as="script"><link rel="prefetch" href="/assets/index.html-412431bf.js" as="script"><link rel="prefetch" href="/assets/index.html-33d8a1ff.js" as="script"><link rel="prefetch" href="/assets/index.html-8a61036e.js" as="script"><link rel="prefetch" href="/assets/index.html-aaa01947.js" as="script"><link rel="prefetch" href="/assets/index.html-c4f6b72f.js" as="script"><link rel="prefetch" href="/assets/index.html-8343d7e7.js" as="script"><link rel="prefetch" href="/assets/index.html-123fb961.js" as="script"><link rel="prefetch" href="/assets/index.html-c0cb89e0.js" as="script"><link rel="prefetch" href="/assets/index.html-6ff0501d.js" as="script"><link rel="prefetch" href="/assets/index.html-4bd3ef9e.js" as="script"><link rel="prefetch" href="/assets/index.html-e0994330.js" as="script"><link rel="prefetch" href="/assets/index.html-93236a78.js" as="script"><link rel="prefetch" href="/assets/index.html-3293ab64.js" as="script"><link rel="prefetch" href="/assets/index.html-18d83bea.js" as="script"><link rel="prefetch" href="/assets/index.html-3474ac31.js" as="script"><link rel="prefetch" href="/assets/index.html-22528c18.js" as="script"><link rel="prefetch" href="/assets/index.html-7c89708e.js" as="script"><link rel="prefetch" href="/assets/index.html-934d8bb3.js" as="script"><link rel="prefetch" href="/assets/index.html-8b5d5571.js" as="script"><link rel="prefetch" href="/assets/index.html-b2893041.js" as="script"><link rel="prefetch" href="/assets/index.html-428cf01d.js" as="script"><link rel="prefetch" href="/assets/index.html-acdc3986.js" as="script"><link rel="prefetch" href="/assets/index.html-4ec32de7.js" as="script"><link rel="prefetch" href="/assets/index.html-5539e32a.js" as="script"><link rel="prefetch" href="/assets/index.html-7e9e6de3.js" as="script"><link rel="prefetch" href="/assets/index.html-a93fcd29.js" as="script"><link rel="prefetch" href="/assets/index.html-c9866817.js" as="script"><link rel="prefetch" href="/assets/index.html-c55efe18.js" as="script"><link rel="prefetch" href="/assets/index.html-75034533.js" as="script"><link rel="prefetch" href="/assets/index.html-f7572395.js" as="script"><link rel="prefetch" href="/assets/index.html-bbf96642.js" as="script"><link rel="prefetch" href="/assets/index.html-4861ad90.js" as="script"><link rel="prefetch" href="/assets/index.html-026e23c7.js" as="script"><link rel="prefetch" href="/assets/index.html-8686c622.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0878ce.js" as="script"><link rel="prefetch" href="/assets/index.html-a141bff8.js" as="script"><link rel="prefetch" href="/assets/index.html-467357b3.js" as="script"><link rel="prefetch" href="/assets/index.html-c7137210.js" as="script"><link rel="prefetch" href="/assets/index.html-42e1e383.js" as="script"><link rel="prefetch" href="/assets/index.html-db8e2a69.js" as="script"><link rel="prefetch" href="/assets/index.html-03d80455.js" as="script"><link rel="prefetch" href="/assets/LRU缓存算法.html-a8e3fdae.js" as="script"><link rel="prefetch" href="/assets/二分查找专题.html-4411774a.js" as="script"><link rel="prefetch" href="/assets/二叉树专题.html-9ccf13ec.js" as="script"><link rel="prefetch" href="/assets/剑指offer专题.html-3db84964.js" as="script"><link rel="prefetch" href="/assets/动态规划专题.html-5e433cc9.js" as="script"><link rel="prefetch" href="/assets/双指针专题.html-59c1b633.js" as="script"><link rel="prefetch" href="/assets/常用算法积累.html-c59464e8.js" as="script"><link rel="prefetch" href="/assets/排序专题.html-e7d62e27.js" as="script"><link rel="prefetch" href="/assets/排序算法及其时间复杂度.html-33ebe0ea.js" as="script"><link rel="prefetch" href="/assets/栈和队列专题.html-41b2a1c6.js" as="script"><link rel="prefetch" href="/assets/红黑树详解.html-976208f2.js" as="script"><link rel="prefetch" href="/assets/递归回溯专题.html-16edae6f.js" as="script"><link rel="prefetch" href="/assets/链表专题.html-79eb63c5.js" as="script"><link rel="prefetch" href="/assets/如何设计秒杀架构.html-b1c31c32.js" as="script"><link rel="prefetch" href="/assets/缓存一致性方案思考.html-f1930b37.js" as="script"><link rel="prefetch" href="/assets/Dubbo超时时间原理.html-e4cbcbe8.js" as="script"><link rel="prefetch" href="/assets/B_树索引原理.html-3ca69b95.js" as="script"><link rel="prefetch" href="/assets/Buffer Pool缓冲池作用.html-54b0159c.js" as="script"><link rel="prefetch" href="/assets/LIMIT分页优化查询.html-af228b47.js" as="script"><link rel="prefetch" href="/assets/MySQL一行记录如何存储.html-68bc1c60.js" as="script"><link rel="prefetch" href="/assets/MySQL日志详解.html-b790c739.js" as="script"><link rel="prefetch" href="/assets/MySQL索引详解.html-3cca7cde.js" as="script"><link rel="prefetch" href="/assets/MySQL锁那些事.html-a6899c7d.js" as="script"><link rel="prefetch" href="/assets/事务隔离级别的实现.html-72c36ce8.js" as="script"><link rel="prefetch" href="/assets/Redis主从复制机制.html-4fab7630.js" as="script"><link rel="prefetch" href="/assets/Redis哨兵模式.html-217eb3be.js" as="script"><link rel="prefetch" href="/assets/Redis持久化.html-07d7ea73.js" as="script"><link rel="prefetch" href="/assets/Redis数据结构与对象.html-cc913df4.js" as="script"><link rel="prefetch" href="/assets/Redis线程模型.html-c8f8079a.js" as="script"><link rel="prefetch" href="/assets/Redis过期删除和内存淘汰.html-9d1d092d.js" as="script"><link rel="prefetch" href="/assets/Redis面试题集锦.html-4a3c3a7e.js" as="script"><link rel="prefetch" href="/assets/缓存击穿、缓存穿透、缓存雪崩.html-0b1d8fc1.js" as="script"><link rel="prefetch" href="/assets/跳表SkipList原理.html-29a73b3c.js" as="script"><link rel="prefetch" href="/assets/MQ简介.html-db462ed8.js" as="script"><link rel="prefetch" href="/assets/RocketMQ框架基础设计.html-bfa8d88a.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——事务消息.html-a083a960.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——服务发现.html-bc49cb57.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——消息存储.html-c3a666d7.js" as="script"><link rel="prefetch" href="/assets/RocketMQ源码解析——通信模块.html-d76ab390.js" as="script"><link rel="prefetch" href="/assets/RocketMQ的事务消息.html-3fe86940.js" as="script"><link rel="prefetch" href="/assets/RocketMQ面试题.html-c923f4b8.js" as="script"><link rel="prefetch" href="/assets/延时发送消息.html-beeec871.js" as="script"><link rel="prefetch" href="/assets/批量发送消息及消息列表分割.html-453a2f6f.js" as="script"><link rel="prefetch" href="/assets/消息发送与消费.html-6370def4.js" as="script"><link rel="prefetch" href="/assets/消息类型.html-9a42e5c9.js" as="script"><link rel="prefetch" href="/assets/消息过滤.html-ad43d776.js" as="script"><link rel="prefetch" href="/assets/顺序消费.html-3aa70705.js" as="script"><link rel="prefetch" href="/assets/Sentinel基础概念.html-e4adc442.js" as="script"><link rel="prefetch" href="/assets/Sentinel流量控制.html-9882ccde.js" as="script"><link rel="prefetch" href="/assets/Sentinel熔断降级.html-21008d2f.js" as="script"><link rel="prefetch" href="/assets/Sentinel限流原理.html-ff1b4060.js" as="script"><link rel="prefetch" href="/assets/Sentinel集群流控.html-08ce2730.js" as="script"><link rel="prefetch" href="/assets/ConfigurationClassPostProcessor源码理解.html-61ac104c.js" as="script"><link rel="prefetch" href="/assets/Spring中Bean的作用域scope.html-0fa97e24.js" as="script"><link rel="prefetch" href="/assets/Spring如何解决循环依赖.html-b7b6ce67.js" as="script"><link rel="prefetch" href="/assets/Spring执行BeanFactoryPostProcessor源码理解.html-89b1e04f.js" as="script"><link rel="prefetch" href="/assets/Spring自定义扩展.html-55eb4ee3.js" as="script"><link rel="prefetch" href="/assets/Comparator比较器返回值理解.html-316984fe.js" as="script"><link rel="prefetch" href="/assets/Java反射.html-83f2954c.js" as="script"><link rel="prefetch" href="/assets/Java的__和equals()的区别.html-060fee9e.js" as="script"><link rel="prefetch" href="/assets/Java的SPI机制.html-9820a063.js" as="script"><link rel="prefetch" href="/assets/Transactional注解原理.html-ce3c9dc3.js" as="script"><link rel="prefetch" href="/assets/深入理解Java序列化.html-9f87e426.js" as="script"><link rel="prefetch" href="/assets/JVM参数详解.html-e6a9e9cd.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收器.html-dbeacec7.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收基础.html-07929489.js" as="script"><link rel="prefetch" href="/assets/AQS源码理解——ReentrantLock.html-ed5dd49f.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal详解.html-80140ef1.js" as="script"><link rel="prefetch" href="/assets/同步器原理及使用场景.html-453dfbc9.js" as="script"><link rel="prefetch" href="/assets/404.html-33d2c41a.js" as="script"><link rel="prefetch" href="/assets/index.html-9b7ecfed.js" as="script"><link rel="prefetch" href="/assets/index.html-f9b17393.js" as="script"><link rel="prefetch" href="/assets/index.html-4124386c.js" as="script"><link rel="prefetch" href="/assets/index.html-9459ec93.js" as="script"><link rel="prefetch" href="/assets/index.html-4a654e21.js" as="script"><link rel="prefetch" href="/assets/index.html-fb1af795.js" as="script"><link rel="prefetch" href="/assets/index.html-2d9bbb5e.js" as="script"><link rel="prefetch" href="/assets/index.html-39061e22.js" as="script"><link rel="prefetch" href="/assets/index.html-3e2ff053.js" as="script"><link rel="prefetch" href="/assets/index.html-adf44129.js" as="script"><link rel="prefetch" href="/assets/index.html-8594cd0b.js" as="script"><link rel="prefetch" href="/assets/index.html-df137cc3.js" as="script"><link rel="prefetch" href="/assets/index.html-84979eed.js" as="script"><link rel="prefetch" href="/assets/index.html-15fda1b4.js" as="script"><link rel="prefetch" href="/assets/index.html-230b13e1.js" as="script"><link rel="prefetch" href="/assets/index.html-64dafe4a.js" as="script"><link rel="prefetch" href="/assets/index.html-71546b67.js" as="script"><link rel="prefetch" href="/assets/index.html-21d24ede.js" as="script"><link rel="prefetch" href="/assets/index.html-846b990f.js" as="script"><link rel="prefetch" href="/assets/index.html-65c4b1e7.js" as="script"><link rel="prefetch" href="/assets/index.html-2e4c0a32.js" as="script"><link rel="prefetch" href="/assets/index.html-a98f26b1.js" as="script"><link rel="prefetch" href="/assets/index.html-7b7bed5d.js" as="script"><link rel="prefetch" href="/assets/index.html-192c700b.js" as="script"><link rel="prefetch" href="/assets/index.html-f1fbd320.js" as="script"><link rel="prefetch" href="/assets/index.html-a533d711.js" as="script"><link rel="prefetch" href="/assets/index.html-958a3dac.js" as="script"><link rel="prefetch" href="/assets/index.html-ad79b6bd.js" as="script"><link rel="prefetch" href="/assets/index.html-2a88e37a.js" as="script"><link rel="prefetch" href="/assets/index.html-95cc1f3e.js" as="script"><link rel="prefetch" href="/assets/index.html-48687635.js" as="script"><link rel="prefetch" href="/assets/index.html-8b9f7895.js" as="script"><link rel="prefetch" href="/assets/index.html-f316a567.js" as="script"><link rel="prefetch" href="/assets/index.html-5181e4e2.js" as="script"><link rel="prefetch" href="/assets/index.html-93e0a9b7.js" as="script"><link rel="prefetch" href="/assets/index.html-eb0e9e64.js" as="script"><link rel="prefetch" href="/assets/index.html-760591fc.js" as="script"><link rel="prefetch" href="/assets/index.html-aa564694.js" as="script"><link rel="prefetch" href="/assets/index.html-b118c881.js" as="script"><link rel="prefetch" href="/assets/index.html-c0b3c67e.js" as="script"><link rel="prefetch" href="/assets/index.html-41f9a7a7.js" as="script"><link rel="prefetch" href="/assets/index.html-9a54f4b0.js" as="script"><link rel="prefetch" href="/assets/index.html-d0bfb773.js" as="script"><link rel="prefetch" href="/assets/index.html-f272aa1f.js" as="script"><link rel="prefetch" href="/assets/index.html-8fa546f8.js" as="script"><link rel="prefetch" href="/assets/index.html-0a9b5049.js" as="script"><link rel="prefetch" href="/assets/index.html-323e9bc2.js" as="script"><link rel="prefetch" href="/assets/index.html-42cce58c.js" as="script"><link rel="prefetch" href="/assets/index.html-cfbd24ed.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/assets/pageview-b9e84375.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><img class="vp-nav-logo" src="/logo_dark.png" alt="Floweryu"><!----><span class="vp-site-name hide-in-pad">Floweryu</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="首页" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="Java" class="vp-link nav-link nav-link" href="/java/"><!---->Java<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="中间件"><span class="title"><!---->中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="MySQL" class="vp-link nav-link nav-link" href="/mysql/"><!---->MySQL<!----></a></li><li class="dropdown-item"><a aria-label="Redis" class="vp-link nav-link nav-link" href="/redis/"><!---->Redis<!----></a></li><li class="dropdown-item"><a aria-label="Sentinel" class="vp-link nav-link nav-link" href="/sentinel/"><!---->Sentinel<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a aria-label="Spring" class="vp-link nav-link active nav-link active" href="/spring/"><!---->Spring<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="RocketMQ" class="vp-link nav-link nav-link" href="/rocketmq/"><!---->RocketMQ<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="Dubbo" class="vp-link nav-link nav-link" href="/dubbo/"><!---->Dubbo<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="算法笔记" class="vp-link nav-link nav-link" href="/algorithm/"><!---->算法笔记<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="随笔"><span class="title"><!---->随笔</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="分布式" class="vp-link nav-link nav-link" href="/distributed/"><!---->分布式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a aria-label="分类" class="vp-link nav-link nav-link" href="/category/"><!---->分类<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="标签" class="vp-link nav-link nav-link" href="/tag/"><!---->标签<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/Floweryu/floweryu.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading clickable active"><!----><a aria-label="Spring" class="vp-link nav-link active vp-sidebar-title nav-link active vp-sidebar-title" href="/spring.html"><!---->Spring<!----></a><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="ConfigurationClassPostProcessor源码理解" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/spring/ConfigurationClassPostProcessor%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A3.html"><!---->ConfigurationClassPostProcessor源码理解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Spring中Bean的作用域" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/spring/Spring%E4%B8%ADBean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9Fscope.html"><!---->Spring中Bean的作用域<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Spring动态AOP原理" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html"><!---->Spring动态AOP原理<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="一.. 引入" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#一-引入"><!---->一.. 引入<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="1.1 概念" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_1-1-概念"><!---->1.1 概念<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="1.2 注解方式使用AOP" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_1-2-注解方式使用aop"><!---->1.2 注解方式使用AOP<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="1.3 xml方式使用AOP" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_1-3-xml方式使用aop"><!---->1.3 xml方式使用AOP<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="1.4 抛出问题？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_1-4-抛出问题"><!---->1.4 抛出问题？<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="a. Advice的执行顺序？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#a-advice的执行顺序"><!---->a. Advice的执行顺序？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="二.. @EnableAspectJAutoProxy注解" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#二-enableaspectjautoproxy注解"><!---->二.. @EnableAspectJAutoProxy注解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="三.. AOP代理创建过程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#三-aop代理创建过程"><!---->三.. AOP代理创建过程<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="3.1 获取增强方法" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_3-1-获取增强方法"><!---->3.1 获取增强方法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="3.2 创建代理" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_3-2-创建代理"><!---->3.2 创建代理<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="JDK和CGLIB代理方式" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#jdk和cglib代理方式"><!---->JDK和CGLIB代理方式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="四.. 生成拦截器链MethodInterceptor" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#四-生成拦截器链methodinterceptor"><!---->四.. 生成拦截器链MethodInterceptor<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="五.. 链式调用增强方法" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#五-链式调用增强方法"><!---->五.. 链式调用增强方法<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="5.1 拦截器调用具体过程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#_5-1-拦截器调用具体过程"><!---->5.1 拦截器调用具体过程<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="调用链路图" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#调用链路图"><!---->调用链路图<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第一次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第一次调用"><!---->第一次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第二次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第二次调用"><!---->第二次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第三次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第三次调用"><!---->第三次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第四次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第四次调用"><!---->第四次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第五次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第五次调用"><!---->第五次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第六次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第六次调用"><!---->第六次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第七次调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#第七次调用"><!---->第七次调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="退栈调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/spring/Spring%E7%9A%84%E5%8A%A8%E6%80%81AOP%E5%8E%9F%E7%90%86.html#退栈调用"><!---->退栈调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul></li></ul><!--]--></li><li><!--[--><a aria-label="Spring如何解决循环依赖" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/spring/Spring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.html"><!---->Spring如何解决循环依赖<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Spring执行BeanFactoryPostProcessor源码理解" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/spring/Spring%E6%89%A7%E8%A1%8CBeanFactoryPostProcessor%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A3.html"><!---->Spring执行BeanFactoryPostProcessor源码理解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Spring自定义扩展" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/spring/Spring%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%A9%E5%B1%95.html"><!---->Spring自定义扩展<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Spring动态AOP原理</h1><div class="page-info"><span class="page-author-info" aria-label="作者"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/Floweryu/floweryu.github.io" target="_blank" rel="noopener noreferrer">Floweryu</a></span><span property="author" content="Floweryu"></span></span><!----><span class="page-date-info" aria-label="写作日期"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-12-29T15:30:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 20 分钟</span><meta property="timeRequired" content="PT20M"></span><span class="page-category-info" aria-label="分类"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item clickable" role="navigation">Spring</span><!--]--><meta property="articleSection" content="Spring"></span><span class="page-tag-info" aria-label="标签"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item clickable" role="navigation">后端</span><!--]--><meta property="keywords" content="后端"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#一-引入">一.. 引入</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_1-1-概念">1.1 概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_1-2-注解方式使用aop">1.2 注解方式使用AOP</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_1-3-xml方式使用aop">1.3 xml方式使用AOP</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_1-4-抛出问题">1.4 抛出问题？</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#a-advice的执行顺序">a. Advice的执行顺序？</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#二-enableaspectjautoproxy注解">二.. @EnableAspectJAutoProxy注解</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#三-aop代理创建过程">三.. AOP代理创建过程</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-1-获取增强方法">3.1 获取增强方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-2-创建代理">3.2 创建代理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#jdk和cglib代理方式">JDK和CGLIB代理方式</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#四-生成拦截器链methodinterceptor">四.. 生成拦截器链MethodInterceptor</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#五-链式调用增强方法">五.. 链式调用增强方法</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_5-1-拦截器调用具体过程">5.1 拦截器调用具体过程</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#调用链路图">调用链路图</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第一次调用">第一次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第二次调用">第二次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第三次调用">第三次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第四次调用">第四次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第五次调用">第五次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第六次调用">第六次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#第七次调用">第七次调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level4 toc-link level4" href="#退栈调用">退栈调用</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="一-引入" tabindex="-1"><a class="header-anchor" href="#一-引入" aria-hidden="true">#</a> 一.. 引入</h2><h3 id="_1-1-概念" tabindex="-1"><a class="header-anchor" href="#_1-1-概念" aria-hidden="true">#</a> 1.1 概念</h3><figure><img src="/assets/image202212262224611-30360159.png" alt="image-20221130195504431" tabindex="0" loading="lazy"><figcaption>image-20221130195504431</figcaption></figure><h3 id="_1-2-注解方式使用aop" tabindex="-1"><a class="header-anchor" href="#_1-2-注解方式使用aop" aria-hidden="true">#</a> 1.2 注解方式使用AOP</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspects</span> <span class="token punctuation">{</span>

<span class="token doc-comment comment">/**
     * 1. 本类引用，只需要写方法名
     * 2. 其他类引用，需要写路径
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public int com.floweryu.aop.MathCalculator.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 前置通知：在目标方法被调用之前调用通知功能
     */</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logStart</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Before执行...&quot;</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 运行开始.......参数列表是: {&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 后置通知：在目标方法调用之后调用通知，此时不关心方法的输出结果
     */</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@After执行...   方法执行结束.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 返回通知：在目标方法执行成功后调用通知
     */</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">&quot;returning&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logReturn</span><span class="token punctuation">(</span><span class="token class-name">Object</span> returning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@AfterReturning执行...   除法正常返回.......返回值: {&quot;</span> <span class="token operator">+</span> returning <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 异常通知：在目标方法抛出异常后调用通知
     */</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;ex&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@AfterThrowing执行...   除法异常.......异常: {&quot;</span> <span class="token operator">+</span> ex <span class="token operator">+</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">logAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Around执行...   方法执行前调用========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 通过反射调用div方法</span>
		<span class="token comment">// 又回到此处CglibAopProxy.CglibMethodInvocation.proceed, 相当于mi.proceed()</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Around执行...   方法执行后调用========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathCalculator</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MathCalculator is running...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i <span class="token operator">/</span> j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-xml方式使用aop" tabindex="-1"><a class="header-anchor" href="#_1-3-xml方式使用aop" aria-hidden="true">#</a> 1.3 xml方式使用AOP</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
	   xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns<span class="token operator">:</span>aop<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/aop&quot;</span>
	   xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;logAspects&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.floweryu.aop.LogAspects&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;mathCalculator&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.floweryu.aop.MathCalculator&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>aop<span class="token operator">:</span>aspect ref<span class="token operator">=</span><span class="token string">&quot;logAspects&quot;</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>pointcut id<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> expression<span class="token operator">=</span><span class="token string">&quot;execution(public int com.floweryu.aop.MathCalculator.*(..))&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>after method<span class="token operator">=</span><span class="token string">&quot;logEnd&quot;</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>before method<span class="token operator">=</span><span class="token string">&quot;logStart&quot;</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>after<span class="token operator">-</span>returning method<span class="token operator">=</span><span class="token string">&quot;logReturn&quot;</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> returning<span class="token operator">=</span><span class="token string">&quot;returning&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>after<span class="token operator">-</span>throwing method<span class="token operator">=</span><span class="token string">&quot;logException&quot;</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> throwing<span class="token operator">=</span><span class="token string">&quot;ex&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>aop<span class="token operator">:</span>around method<span class="token operator">=</span><span class="token string">&quot;logAround&quot;</span> pointcut<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;pointCut&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>aspect<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>aop<span class="token operator">:</span>config<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>aop<span class="token operator">:</span>aspectj<span class="token operator">-</span>autoproxy <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-抛出问题" tabindex="-1"><a class="header-anchor" href="#_1-4-抛出问题" aria-hidden="true">#</a> 1.4 抛出问题？</h3><h4 id="a-advice的执行顺序" tabindex="-1"><a class="header-anchor" href="#a-advice的执行顺序" aria-hidden="true">#</a> a. Advice的执行顺序？</h4><figure><img src="/assets/image202212262225516-f9bc7ab0.png" alt="image-20221130214127496" tabindex="0" loading="lazy"><figcaption>image-20221130214127496</figcaption></figure><!----><figure><img src="/assets/image202212262225082-956b5501.png" alt="image-20221130214215063" tabindex="0" loading="lazy"><figcaption>image-20221130214215063</figcaption></figure><!----><p>对比上面两张图片，可以看到**@Around、@After、@Before**这三个执行顺序有变化。</p><p>在Spring5.x或6.x，省略@Around的时候，执行顺序为：</p><ul><li>正常情况：@Before —-&gt; 目标方法 —-&gt; @AfterReturning —-&gt; @After</li><li>异常情况：@Before —-&gt; 目标方法 —-&gt; @AfterThrowing —-&gt; @After</li></ul><h2 id="二-enableaspectjautoproxy注解" tabindex="-1"><a class="header-anchor" href="#二-enableaspectjautoproxy注解" aria-hidden="true">#</a> 二.. @EnableAspectJAutoProxy注解</h2><blockquote><p>以注解方式为例开始源码阅读。</p></blockquote><p>关键在于**@EnableAspectJAutoProxy<strong>注解，开启了AspectJ的代理功能，顺着该注解点下去，可以在</strong>AopConfigUtils类**中找到下面这一段代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BeanDefinition</span> <span class="token function">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="token punctuation">(</span>
    <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 该方法会自动注册AnnotationAwareAspectJAutoProxyCreator类, 并且如果有其他代理，会根据代理优先级注入</span>
    <span class="token keyword">return</span> <span class="token function">registerOrEscalateApcAsRequired</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareAspectJAutoProxyCreator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> registry<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BeanDefinition</span> <span class="token function">registerOrEscalateApcAsRequired</span><span class="token punctuation">(</span>
			<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cls<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token string">&quot;BeanDefinitionRegistry must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果有org.springframework.aop.config.internalAutoProxyCreator代理，则根据优先级注入代理</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">AUTO_PROXY_CREATOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">BeanDefinition</span> apcDefinition <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">AUTO_PROXY_CREATOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cls<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>apcDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">int</span> currentPriority <span class="token operator">=</span> <span class="token function">findPriorityForClass</span><span class="token punctuation">(</span>apcDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> requiredPriority <span class="token operator">=</span> <span class="token function">findPriorityForClass</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>currentPriority <span class="token operator">&lt;</span> requiredPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					apcDefinition<span class="token punctuation">.</span><span class="token function">setBeanClassName</span><span class="token punctuation">(</span>cls<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// ......</span>
		<span class="token keyword">return</span> beanDefinition<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面就将<strong>AnnotationAwareAspectJAutoProxyCreator</strong>类注入到容器中。</p><h2 id="三-aop代理创建过程" tabindex="-1"><a class="header-anchor" href="#三-aop代理创建过程" aria-hidden="true">#</a> 三.. AOP代理创建过程</h2><h3 id="_3-1-获取增强方法" tabindex="-1"><a class="header-anchor" href="#_3-1-获取增强方法" aria-hidden="true">#</a> 3.1 获取增强方法</h3><p>看一下核心类：<strong>AnnotationAwareAspectJAutoProxyCreator</strong>做了哪些事情？</p><figure><img src="/assets/image202212262225819-8c9c24c7.png" alt="image-20221122210650156" tabindex="0" loading="lazy"><figcaption>image-20221122210650156</figcaption></figure><p><code>AnnotationAwareAspectJAutoProxyCreator</code>实现了<code>BeanFactoryAware</code>接口，这样当Spring加载到这个Bean时会调用其<code>postProcessAfterInitialization</code>方法：</p><blockquote><p>代码：org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#postProcessAfterInitialization</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
	 * 此处是真正创建aop代理的地方, 在实例化之后, 初始化之后就进行处理
	 * 首先查看是否在earlyProxyReferences里是否存在, 如果有就说明处理过了, 不存在就考虑是否进行代理
	 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">getAdvicesAndAdvisorsForBean</span></span>
	 * 在解决循环依赖时也用到earlyProxyReferences和wrapIfNecessary
	 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">String</span><span class="token punctuation">)</span></span>
	 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取当前bean的key: 如果beanName不为空, 则以beanName为Key</span>
        <span class="token comment">// 如果为FactoryBean类型, 前面会添加&amp;符号</span>
        <span class="token comment">// 如果beanName为空, 则以当前bean对应的class为key</span>
        <span class="token class-name">Object</span> cacheKey <span class="token operator">=</span> <span class="token function">getCacheKey</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断当前bean是否正在被代理, 如果正在被代理则不进行封装</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>earlyProxyReferences<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span> <span class="token operator">!=</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果bean需要被代理, 则需要封装指定的bean</span>
            <span class="token keyword">return</span> <span class="token function">wrapIfNecessary</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">wrapIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> cacheKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果已经被处理过, 直接返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>targetSourcedBeans<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这里的advisedBeans缓存了已经进行了代理的bean，如果缓存中存在, 则可以直接返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advisedBeans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// isInfrastructureClass(cls)用户判断当前cls是否为spring自带的bean, 自带的bean是不用代理的, 见下</span>
    <span class="token comment">// Advice/Pointcut/Advisor/AopInfrastructureBean的类或子类</span>
    <span class="token comment">// shouldSkip()用于判断当前bean是否应该被略过(bean的名称是否以.ORIGINAL结尾)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInfrastructureClass</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">shouldSkip</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对当前bean进行缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>advisedBeans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 图(1) &amp;&amp; 核心代码		获取当前bean的Advices和Advisors, Interceptors</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> specificInterceptors <span class="token operator">=</span> <span class="token function">getAdvicesAndAdvisorsForBean</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>specificInterceptors <span class="token operator">!=</span> <span class="token constant">DO_NOT_PROXY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对当前bean的代理状态进行缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>advisedBeans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据获取到的Advices和Advisors为当前bean生成代理对象(见创建代理一节)</span>
        <span class="token class-name">Object</span> proxy <span class="token operator">=</span> <span class="token function">createProxy</span><span class="token punctuation">(</span>
            bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> specificInterceptors<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SingletonTargetSource</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 缓存生成的代理bean的类型, 并且返回生成的代理bean </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>proxyTypes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> proxy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>advisedBeans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image202212262225561-9100a646.png" alt="image-20221127222022040" tabindex="0" loading="lazy"><figcaption>image-20221127222022040</figcaption></figure><!----><blockquote><p>核心代码：AbstractAdvisorAutoProxyCreator#<strong>getAdvicesAndAdvisorsForBean</strong></p></blockquote><p>先总结一下该方法做了哪些事情：</p><ul><li>获取所有增强方法（即LogAspects切面定义的各个方法）。</li><li>通过切点表达式pointCut判断这些增强方法是否可为当前Bean所用。</li><li>如果有符合的通知方法，则对它们进行排序（排序规则不同版本Spring有所不同，这里就可以解释xml和注解方式使用aop为什么顺序不同）。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAdvicesAndAdvisorsForBean</span><span class="token punctuation">(</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">TargetSource</span> targetSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 核心方法: 找到合适的增强对象</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> advisors <span class="token operator">=</span> <span class="token function">findEligibleAdvisors</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>advisors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">DO_NOT_PROXY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> advisors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	

<span class="token comment">//核心方法</span>
<span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> <span class="token function">findEligibleAdvisors</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 图(1). 对所有的切面逻辑进行封装, 从而得到目标Advisor.  	</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> candidateAdvisors <span class="token operator">=</span> <span class="token function">findCandidateAdvisors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 图(2). 对所有的Advisor进行判断, 看其切面定义是否可以应用到当前bean, 从而得到最终需要应用的Advisor(这里不详细介绍)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> eligibleAdvisors <span class="token operator">=</span> <span class="token function">findAdvisorsThatCanApply</span><span class="token punctuation">(</span>candidateAdvisors<span class="token punctuation">,</span> beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 图(3). 提供hook方法, 用于对目标Advisor进行扩展, 可以看到比图(2)多了一个Advisor</span>
    <span class="token function">extendAdvisors</span><span class="token punctuation">(</span>eligibleAdvisors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eligibleAdvisors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对需要代理的Advisor按照一定规则进行排序. </span>
        <span class="token comment">// 在有多个切面的情况下, 多个切点使用了同一个连接点, 这样就需要有一定的顺序, 可以配置@Order来决定顺序</span>
		<span class="token comment">// 里面大概是一个拓扑排序，所以会xml方式和注解方式的执行顺序会有一些不同(在使用@Around、@Before、@After情况下)</span>
        <span class="token comment">// 核心代码</span>
        eligibleAdvisors <span class="token operator">=</span> <span class="token function">sortAdvisors</span><span class="token punctuation">(</span>eligibleAdvisors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> eligibleAdvisors<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image202212262225225-a4160497.png" alt="image-20221127134219062" tabindex="0" loading="lazy"><figcaption>image-20221127134219062</figcaption></figure><!----><figure><img src="/assets/image202212262225257-0a48591e.png" alt="image-20221127212733993" tabindex="0" loading="lazy"><figcaption>image-20221127212733993</figcaption></figure><!----><figure><img src="/assets/image202212262225202-67bfca54.png" alt="image-20221127212918752" tabindex="0" loading="lazy"><figcaption>image-20221127212918752</figcaption></figure><!----><blockquote><p>核心代码: AbstractAdvisorAutoProxyCreator#<strong>sortAdvisors</strong></p><p><strong>拓扑排序</strong>：在有向无环图下，每次排序选取无前驱的节点</p><figure><img src="/assets/image202212262225090-5d082bec.png" alt="image-20221130222304262" tabindex="0" loading="lazy"><figcaption>image-20221130222304262</figcaption></figure><p><strong>增强器执行顺序</strong>：</p><p>官方文档对此有说明：https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj-advice-ordering</p><ul><li>在同一个Aspect 切面中，针对同一个 pointCut，定义了两个相同的 Advice（比如：定义了两个 @Before)，那么这两个 advice 的执行顺序是无法确定的，哪怕你给这两个 advice 添加了 @Order 这个注解，也不行。</li><li>针对不同的Aspect切面中，需要实现<strong>org.springframework.core.Ordered</strong>接口，实现它的**getOrder()**方法，值越小的 aspect 越先执行。否则执行顺序不固定</li></ul></blockquote><h3 id="_3-2-创建代理" tabindex="-1"><a class="header-anchor" href="#_3-2-创建代理" aria-hidden="true">#</a> 3.2 创建代理</h3><blockquote><p>createProxy方法点进去在6.x版本会直接进去buildProxy方法，该方法在经过一系列的判断后执行proxyFactory.getProxy(classLoader)创建代理对象</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">buildProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> specificInterceptors<span class="token punctuation">,</span> <span class="token class-name">TargetSource</span> targetSource<span class="token punctuation">,</span> <span class="token keyword">boolean</span> classOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 给bean定义设置一个属性originalTargetClass(不重要)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AutoProxyUtils</span><span class="token punctuation">.</span><span class="token function">exposeTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> beanClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建一个代理工厂</span>
    <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取当前类相关属性</span>
    proxyFactory<span class="token punctuation">.</span><span class="token function">copyFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 判断对于给定的bean是否应该使用targetClass代理而不是它的接口代理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>proxyFactory<span class="token punctuation">.</span><span class="token function">isProxyTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Explicit handling of JDK proxy targets and lambdas (for introduction advice scenarios)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">isProxyClass</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isLambdaClass</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Must allow for introductions; can&#39;t just set interfaces to the proxy&#39;s interfaces only.</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> ifc <span class="token operator">:</span> beanClass<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                proxyFactory<span class="token punctuation">.</span><span class="token function">addInterface</span><span class="token punctuation">(</span>ifc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 检查preserveTargetClass, 判断是使用JDK代理还是 CGLIB代理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldProxyTargetClass</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果是使用CGLIB代理</span>
            proxyFactory<span class="token punctuation">.</span><span class="token function">setProxyTargetClass</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 添加代理接口</span>
            <span class="token function">evaluateProxyInterfaces</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> proxyFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 构建增强器</span>
    <span class="token class-name">Advisor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> advisors <span class="token operator">=</span> <span class="token function">buildAdvisors</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> specificInterceptors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置增强器</span>
    proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvisors</span><span class="token punctuation">(</span>advisors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置要代理的类(MathCalculator)</span>
    proxyFactory<span class="token punctuation">.</span><span class="token function">setTargetSource</span><span class="token punctuation">(</span>targetSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 定制代理</span>
    <span class="token function">customizeProxyFactory</span><span class="token punctuation">(</span>proxyFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 代理工厂配置之后, 是否还允许被修改, 默认值是false</span>
    proxyFactory<span class="token punctuation">.</span><span class="token function">setFrozen</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>freezeProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">advisorsPreFiltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">setPreFiltered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 新版本新增</span>
    <span class="token comment">// Use original ClassLoader if bean class not locally loaded in overriding class loader</span>
    <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token function">getProxyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token keyword">instanceof</span> <span class="token class-name">SmartClassLoader</span> <span class="token operator">&amp;&amp;</span> classLoader <span class="token operator">!=</span> beanClass<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        classLoader <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SmartClassLoader</span><span class="token punctuation">)</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOriginalClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 图(1)   classOnly是false, 所以走getProxy</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>classOnly <span class="token operator">?</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxyClass</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span> <span class="token operator">:</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image202212262225666-f65fa3d0.png" alt="image-20221130225226529" tabindex="0" loading="lazy"><figcaption>image-20221130225226529</figcaption></figure><!----><p>后续从IOC容器中获得的TargetClass就是被代理后的对象，执行代理对象的目标方法的时候，代理对象会执行相应的通知方法链。</p><blockquote><p>核心代码：org.springframework.aop.framework.DefaultAopProxyFactory#createAopProxy，由proxyFactory.getProxy进入</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">AopProxy</span> <span class="token function">createAopProxy</span><span class="token punctuation">(</span><span class="token class-name">AdvisedSupport</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AopConfigException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断选择哪种创建代理对象的方式</span>
    <span class="token comment">// config.isOptimize(): 是否对代理类的生成使用策略优化, 作用和isProxyTargetClass(使用aop时可配置)是一样的, 默认为false</span>
    <span class="token comment">// config.isProxyTargetClass(): 是否使用CGLIB的方式创建代理对象, 默认为false</span>
    <span class="token comment">// hasNoUserSuppliedProxyInterfaces: 目标类是否有接口存在 并且 只有一个接口时接口类型是否为SpringProxy类型</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isOptimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> config<span class="token punctuation">.</span><span class="token function">isProxyTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">hasNoUserSuppliedProxyInterfaces</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 上面三个方法有一个为true就进入这里</span>
        <span class="token comment">// 从AdvisordSupport中获取目标类, 对象</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>targetClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AopConfigException</span><span class="token punctuation">(</span><span class="token string">&quot;TargetSource cannot determine target class: &quot;</span> <span class="token operator">+</span>
                                         <span class="token string">&quot;Either an interface or a target is required for proxy creation.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果目标类是接口 Proxy类型 lambad表达式(新增), 则还是使用JDK方式生成代理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>targetClass<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">isProxyClass</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isLambdaClass</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 目标类没有接口配置了使用CGLIB进行动态代理, 使用CGLIB创建代理对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ObjenesisCglibAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用JDK方式创建代理对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="jdk和cglib代理方式" tabindex="-1"><a class="header-anchor" href="#jdk和cglib代理方式" aria-hidden="true">#</a> JDK和CGLIB代理方式</h4><ul><li>如果目标对象实现了接口，默认情况下会采用JDK的动态代理实现AOP</li><li>如果目标对象实现了接口，可以强制使用CGLIB实现AOP，方法见下。</li><li>如果目标对象没有实现接口，必须采用CGLIB库，Spring会自动在JDK和CGLIB中转换。</li></ul><p><strong>如何强制使用CGLIB代理？</strong></p><ul><li>添加CGLIB库</li><li>设置<code>proxyTargetClass = true</code></li></ul><hr><p><strong>JDK代理和CGLIB代理区别：</strong></p><ul><li>JDK动态代理只能针对实现了接口的类生成代理，不能针对类。</li><li>CGLIB代理是针对类实现的代理，主要是针对指定的类生成一个子类，覆盖其中的方法，<strong>因为是继承，所以该类或方法最好不要声明为final</strong>。</li></ul><h2 id="四-生成拦截器链methodinterceptor" tabindex="-1"><a class="header-anchor" href="#四-生成拦截器链methodinterceptor" aria-hidden="true">#</a> 四.. 生成拦截器链MethodInterceptor</h2><p>AOP代理对象生成后，接着关注代理对象的目标方法执行时，增强方法是怎么被执行的。</p><figure><img src="/assets/image202212262226122-2bcb90f2.png" alt="image-20221130225619829" tabindex="0" loading="lazy"><figcaption>image-20221130225619829</figcaption></figure><p>在目标方法执行这里打上断点，开始debug。</p><figure><img src="/assets/image202212262226881-daeef360.png" alt="image-20221130225831730" tabindex="0" loading="lazy"><figcaption>image-20221130225831730</figcaption></figure><p>可以看到获取到的bean就是前面CGLIB代理后的Bean（<strong>MathCalculator$$SpringCGLIB</strong>）。</p><p>Step Into进入内部，程序跳转到下面方法中，说明目标对象的目标方法被拦截了，主要逻辑如下：</p><blockquote><p>拦截器起点：CglibAopProxy.DynamicAdvisedInterceptor#intercept</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> oldProxy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> setProxyContext <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 存放的是要代理的对象(例如: MathCalculator)</span>
    <span class="token class-name">TargetSource</span> targetSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不重要</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span>exposeProxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Make invocation available if necessary.</span>
            oldProxy <span class="token operator">=</span> <span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">setCurrentProxy</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            setProxyContext <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Get as late as possible to minimize the time we &quot;own&quot; the target, in case it comes from a pool...</span>
        <span class="token comment">// 获取应用的class类</span>
        target <span class="token operator">=</span> targetSource<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 核心方法: 从advised中获取配置好的AOP拦截器链</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> chain <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> retVal<span class="token punctuation">;</span>
        <span class="token comment">// Check whether we only have one InvokerInterceptor: that is,</span>
        <span class="token comment">// no real advice, but just reflective invocation of the target.</span>
        <span class="token comment">// 如果拦截器链为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>chain<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// We can skip creating a MethodInvocation: just invoke the target directly.</span>
            <span class="token comment">// Note that the final invoker must be an InvokerInterceptor, so we know</span>
            <span class="token comment">// it does nothing but a reflective operation on the target, and no hot</span>
            <span class="token comment">// swapping or fancy proxying.</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsToUse <span class="token operator">=</span> <span class="token class-name">AopProxyUtils</span><span class="token punctuation">.</span><span class="token function">adaptArgumentsIfNecessary</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 直接激活原方法</span>
            retVal <span class="token operator">=</span> <span class="token class-name">AopUtils</span><span class="token punctuation">.</span><span class="token function">invokeJoinpointUsingReflection</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> argsToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// We need to create a method invocation...</span>
            <span class="token comment">// 核心方法：通过CglibMethodInvocation来启动advice通知, 相当于一个纽带</span>
            retVal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibMethodInvocation</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> targetClass<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> methodProxy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        retVal <span class="token operator">=</span> <span class="token function">processReturnType</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> retVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>targetSource<span class="token punctuation">.</span><span class="token function">isStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            targetSource<span class="token punctuation">.</span><span class="token function">releaseTarget</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>setProxyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Restore old proxy.</span>
            <span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">setCurrentProxy</span><span class="token punctuation">(</span>oldProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里先重点关注下<strong>getInterceptorsAndDynamicInterceptionAdvice</strong>方法，其源码如下所示：</p><blockquote><p>核心方法： AdvisedSupport#getInterceptorsAndDynamicInterceptionAdvice 获取拦截器链</p><p>所谓的拦截器链，就是在代理对象的某个方法被执行时，从通知方法集合（创建代理对象的时候就已经将可用通知集合保存在代理对象中了）中筛选出适用于该方法的通知，然后封装为拦截器对象集合（类型为MethodInteceptor，下面会介绍到）。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建一个method对象, 在MethodCacheKey中实现了equals和hashcode, 还实现了compareTo方法</span>
    <span class="token class-name">MethodCacheKey</span> cacheKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodCacheKey</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cached <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methodCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 先从缓存中获取, 缓存中获取不到再调用方法获取, 然后再放到缓存中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 核心方法: 获取MethodInterceptor</span>
        cached <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advisorChainFactory<span class="token punctuation">.</span><span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">,</span> method<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>methodCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> cached<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续查看<strong>this.advisorChainFactory.getInterceptorsAndDynamicInterceptionAdvice</strong>源码</p><blockquote><p>核心方法：DefaultAdvisorChainFactory#getInterceptorsAndDynamicInterceptionAdvice 主要逻辑：</p><p>遍历代理对象的增强器集合，然后判断是否可以应用于当前调用的目标方法，如果可以，则将增强器（Advisor）转换为MethodInterceptor（直接转换，或者通过适配器转换），最终添加到interceptorList列表中。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>
    <span class="token class-name">Advised</span> config<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// This is somewhat tricky... We have to process introductions first,</span>
    <span class="token comment">// but we need to preserve order in the ultimate list.</span>
    <span class="token comment">// 这里使用了单例模式, 获取DefaultAdvisorAdapterRegistry实例</span>
    <span class="token comment">// spring符合单一职责的原则有很多, 每个功能都会有响应的类去处理</span>
    <span class="token comment">// 主要作用是将Advice适配为Advisor, 将Advisor适配为对应的MethodInterceptor</span>
    <span class="token class-name">AdvisorAdapterRegistry</span> registry <span class="token operator">=</span> <span class="token class-name">GlobalAdvisorAdapterRegistry</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个之前获取到的通知个数集合</span>
    <span class="token class-name">Advisor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> advisors <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getAdvisors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> interceptorList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>advisors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果目标类为null的话, 则从方法签名中获取目标类</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> actualClass <span class="token operator">=</span> <span class="token punctuation">(</span>targetClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> targetClass <span class="token operator">:</span> method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断是否有引介增强</span>
    <span class="token class-name">Boolean</span> hasIntroductions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环目标方法匹配的通知</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Advisor</span> advisor <span class="token operator">:</span> advisors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>advisor <span class="token keyword">instanceof</span> <span class="token class-name">PointcutAdvisor</span> pointcutAdvisor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Add it conditionally.</span>
            <span class="token comment">// 提前进行前置过滤或者当前的Advisor适用于目标类(MathCalculator)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isPreFiltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> pointcutAdvisor<span class="token punctuation">.</span><span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>actualClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">MethodMatcher</span> mm <span class="token operator">=</span> pointcutAdvisor<span class="token punctuation">.</span><span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> match<span class="token punctuation">;</span>
                <span class="token comment">// 检查Advisor是否适用于此目标方法</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mm <span class="token keyword">instanceof</span> <span class="token class-name">IntroductionAwareMethodMatcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasIntroductions <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        hasIntroductions <span class="token operator">=</span> <span class="token function">hasMatchingIntroductions</span><span class="token punctuation">(</span>advisors<span class="token punctuation">,</span> actualClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    match <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">IntroductionAwareMethodMatcher</span><span class="token punctuation">)</span> mm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> actualClass<span class="token punctuation">,</span> hasIntroductions<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 匹配当前method是否属于目标类</span>
                    match <span class="token operator">=</span> mm<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> actualClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 核心方法：通过advisor获取拦截器链</span>
                    <span class="token class-name">MethodInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mm<span class="token punctuation">.</span><span class="token function">isRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// Creating a new object instance in the getInterceptors() method</span>
                        <span class="token comment">// isn&#39;t a problem as we normally cache created chains.</span>
                        <span class="token comment">// 动态切入点会创建一个InterceptorAndDynamicMethodMatcher对象</span>
                        <span class="token comment">// 这个对象包含MethodInterceptor和MethodMatcher实例</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span> interceptor <span class="token operator">:</span> interceptors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            interceptorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InterceptorAndDynamicMethodMatcher</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">,</span> mm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>advisor <span class="token keyword">instanceof</span> <span class="token class-name">IntroductionAdvisor</span> ia<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isPreFiltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> ia<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>actualClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Interceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Interceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> interceptorList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面代码中，重点关注一下**registry.getInterceptors(advisor)**这个核心代码：</p><blockquote><p>核心代码: DefaultAdvisorAdapterRegistry#getInterceptors</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token class-name">Advisor</span> advisor<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnknownAdviceTypeException</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">&gt;</span></span> interceptors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 从advisor中获取advice</span>
    <span class="token class-name">Advice</span> advice <span class="token operator">=</span> advisor<span class="token punctuation">.</span><span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>advice <span class="token keyword">instanceof</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> advice<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AdvisorAdapter</span> adapter <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adapters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断当前advice是否为下面三种</span>
        <span class="token comment">// MethodBeforeAdviceAdapter  AfterReturningAdviceAdapter  ThrowsAdviceAdapter</span>
        <span class="token comment">// 上面三种都没有实现MethodInterceptor接口</span>
        <span class="token comment">// 如果匹配到, 就添加对应的MethodInterceptor</span>
        <span class="token comment">// 为什么要这样设计? 便于扩展</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">supportsAdvice</span><span class="token punctuation">(</span>advice<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">getInterceptor</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>interceptors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAdviceTypeException</span><span class="token punctuation">(</span>advisor<span class="token punctuation">.</span><span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> interceptors<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<strong>this.adapters</strong>里面成员如下：</p><figure><img src="/assets/image202212262226715-e50e3bf9.png" alt="image-20221130231741899" tabindex="0" loading="lazy"><figcaption>image-20221130231741899</figcaption></figure><blockquote><p>为什么这三个增强器是通过适配器转换？</p><p>这里整理一下所有增强器实现的接口：</p><img src="/assets/image202212262226938-4a3ecca0.png" alt="image-20221130232128534" style="zoom:80%;"><p>原本所有的advice都可以实现MethodInterceptor接口，但是这样的话再组装MethodInterceptor的时候，就需要添加额外的逻辑才能添加两次MethodInterceptor。</p><p>为了提高扩展性，这里提供了适配器模式，MethodInterceptor接口的某些advice直接通过适配器来实现，而不需要通过原来的方式，这样就可以更好更方便的扩展添加advice。</p></blockquote><h2 id="五-链式调用增强方法" tabindex="-1"><a class="header-anchor" href="#五-链式调用增强方法" aria-hidden="true">#</a> 五.. 链式调用增强方法</h2><blockquote><p>在获取到拦截器链后，会调用核心方法：retVal = new CglibMethodInvocation(proxy, target, method, args, targetClass, chain, methodProxy).proceed();</p></blockquote><figure><img src="/assets/image202212262226218-061764a8.png" alt="image-20221130233319324" tabindex="0" loading="lazy"><figcaption>image-20221130233319324</figcaption></figure><blockquote><p>进入CglibAopProxy.CglibMethodInvocation#proceed方法，该方法在后面会多次调用</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只需要关注这个方法即可</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">declaresException</span><span class="token punctuation">(</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token class-name">KotlinDetector</span><span class="token punctuation">.</span><span class="token function">isKotlinType</span><span class="token punctuation">(</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Propagate original exception if declared on the target method</span>
            <span class="token comment">// (with callers expecting it). Always propagate it for Kotlin code</span>
            <span class="token comment">// since checked exceptions do not have to be explicitly declared there.</span>
            <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Checked exception thrown in the interceptor but not declared on the</span>
            <span class="token comment">// target method signature -&gt; apply an UndeclaredThrowableException,</span>
            <span class="token comment">// aligned with standard JDK dynamic proxy behavior.</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-1-拦截器调用具体过程" tabindex="-1"><a class="header-anchor" href="#_5-1-拦截器调用具体过程" aria-hidden="true">#</a> 5.1 拦截器调用具体过程</h3><h4 id="调用链路图" tabindex="-1"><a class="header-anchor" href="#调用链路图" aria-hidden="true">#</a> 调用链路图</h4><figure><img src="/assets/image202212262226947-7bd20dc1.png" alt="image-20221201181120228" tabindex="0" loading="lazy"><figcaption>image-20221201181120228</figcaption></figure><blockquote><p>核心方法：ReflectiveMethodInvocation#proceed</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token comment">// We start with an index of -1 and increment early.</span>
    <span class="token comment">// 从索引为-1的拦截器开始调用, 并按序递增</span>
    <span class="token comment">// 如果拦截器链中的拦截器迭代调用完毕, 开始调用target函数, 这个函数是通过反射完成的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentInterceptorIndex <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorsAndDynamicMethodMatchers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始调用目标函数</span>
        <span class="token keyword">return</span> <span class="token function">invokeJoinpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取下一个要执行的拦截器</span>
    <span class="token class-name">Object</span> interceptorOrInterceptionAdvice <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorsAndDynamicMethodMatchers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentInterceptorIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>interceptorOrInterceptionAdvice <span class="token keyword">instanceof</span> <span class="token class-name">InterceptorAndDynamicMethodMatcher</span> dm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Evaluate dynamic method matcher here: static part will already have</span>
        <span class="token comment">// been evaluated and found to match.</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>targetClass <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dm<span class="token punctuation">.</span>methodMatcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">,</span> targetClass<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> dm<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Dynamic matching failed.</span>
            <span class="token comment">// Skip this interceptor and invoke the next in the chain.</span>
            <span class="token keyword">return</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// It&#39;s an interceptor, so we just invoke it: The pointcut will have</span>
        <span class="token comment">// been evaluated statically before this object was constructed.</span>
        <span class="token comment">// 因为前面获取到的拦截器对象里面都是拦截器, 所以直接调用这里, 将this作为参数传递以保证当前实例中调用链的执行</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> interceptorOrInterceptionAdvice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第一次调用" tabindex="-1"><a class="header-anchor" href="#第一次调用" aria-hidden="true">#</a> 第一次调用</h4><p>程序第一次进该方法时<strong>currentInterceptorIndex值为0</strong>，<strong>this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)<strong>取出拦截器链第一个拦截器</strong>ExposeInvocationInterceptor</strong>，方法最后调用该拦截器的invoke方法，Step Into进入该方法：</p><img src="/assets/image202212262226516-4fdc07c8.png" alt="image-20221130234031353" style="zoom:80%;"><p><strong>mi</strong>就是我们传入的<strong>ReflectiveMethodInvocation</strong>对象，程序执行到<strong>mi.proceed</strong>方法时，Step Into进入该方法：</p><h4 id="第二次调用" tabindex="-1"><a class="header-anchor" href="#第二次调用" aria-hidden="true">#</a> 第二次调用</h4><p>可以看到，此时程序第二次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为1</strong>，取出拦截器链第二个拦截器<strong>AspectJAroundAdvice</strong>，方法最后调用该拦截器的invoke方法，Step Into进入该方法：</p><img src="/assets/image202212262226203-cceeb135.png" alt="image-20221130234606525" style="zoom:80%;"><blockquote><p>AspectJAroundAdvice#invoke</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>mi <span class="token keyword">instanceof</span> <span class="token class-name">ProxyMethodInvocation</span> pmi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;MethodInvocation is not a Spring ProxyMethodInvocation: &quot;</span> <span class="token operator">+</span> mi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 创建MethodInvocationProceedingJoinPoint对象包装, 这个对象实现了ProceedingJoinPoint接口</span>
    <span class="token comment">// 而在@Around注解下, 入参参数正是 ProceedingJoinPoint</span>
    <span class="token class-name">ProceedingJoinPoint</span> pjp <span class="token operator">=</span> <span class="token function">lazyGetProceedingJoinPoint</span><span class="token punctuation">(</span>pmi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JoinPointMatch</span> jpm <span class="token operator">=</span> <span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span>pmi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用通知的方法</span>
    <span class="token keyword">return</span> <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span>pjp<span class="token punctuation">,</span> jpm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>核心方法：AbstractAspectJAdvice#invokeAdviceMethodWithGivenArgs</p><p>该方法会调用增强器方法，如果通过debug模式，可以看到每次执行增强器方法时，都会经过该方法。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">invokeAdviceMethodWithGivenArgs</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> actualArgs <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token comment">// 判断通知的方法是否有参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aspectJAdviceMethod<span class="token punctuation">.</span><span class="token function">getParameterCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actualArgs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">makeAccessible</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aspectJAdviceMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行方法, 这时会执行增强器里面逻辑</span>
        <span class="token comment">// 比如@Around增强, 会执行com.floweryu.aop.LogAspects.logAround里面逻辑</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aspectJAdviceMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aspectInstanceFactory<span class="token punctuation">.</span><span class="token function">getAspectInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> actualArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AopInvocationException</span><span class="token punctuation">(</span><span class="token string">&quot;Mismatch on arguments to advice method [&quot;</span> <span class="token operator">+</span>
                                         <span class="token keyword">this</span><span class="token punctuation">.</span>aspectJAdviceMethod <span class="token operator">+</span> <span class="token string">&quot;]; pointcut expression [&quot;</span> <span class="token operator">+</span>
                                         <span class="token keyword">this</span><span class="token punctuation">.</span>pointcut<span class="token punctuation">.</span><span class="token function">getPointcutExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">.</span><span class="token function">getTargetException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>跳转到<strong>logAround</strong>方法执行：</p><figure><img src="/assets/image202212262226716-28bc75f1.png" alt="image-20221130235312203" tabindex="0" loading="lazy"><figcaption>image-20221130235312203</figcaption></figure><p>可以看到，代码会跳转到<strong>logAround</strong>方法中，在输出方法执行前逻辑后，会继续执行<strong>proceed</strong>方法回到拦截器链中。此时控制台打印：</p><figure><img src="/assets/image202212262226469-8ee7f100.png" alt="image-20221201000037954" tabindex="0" loading="lazy"><figcaption>image-20221201000037954</figcaption></figure><h4 id="第三次调用" tabindex="-1"><a class="header-anchor" href="#第三次调用" aria-hidden="true">#</a> 第三次调用</h4><p>程序并没有完全执行<strong>logAround</strong>，而是回到拦截器链中进行第三次调用，此时程序第三次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为2</strong>，取出拦截器链第三个拦截器<strong>MethodBeforeAdviceInterceptor</strong>，Step Into进入invoke方法。</p><figure><img src="/assets/image202212262226416-f101672f.png" alt="image-20221130235613060" tabindex="0" loading="lazy"><figcaption>image-20221130235613060</figcaption></figure><blockquote><p>Before拦截器：MethodBeforeAdviceInterceptor#invoke</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行前置通知方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>advice<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>mi<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行下一个拦截器, 但是该拦截器是方法前执行的最后一个了, 所以会调用目标方法</span>
    <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行完<strong>before</strong>方法后，控制台输出如下：</p><figure><img src="/assets/image202212262226931-a843042b.png" alt="image-20221201000214146" tabindex="0" loading="lazy"><figcaption>image-20221201000214146</figcaption></figure><p>执行<strong>mi.proceed()</strong>，进入第四次调用</p><h4 id="第四次调用" tabindex="-1"><a class="header-anchor" href="#第四次调用" aria-hidden="true">#</a> 第四次调用</h4><p>此时程序第四次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为3</strong>，取出拦截器链第四个拦截器<strong>AspectJAfterAdvice</strong>，Step Into进入invoke方法。</p><figure><img src="/assets/image202212262226220-b8622597.png" alt="image-20221201000512886" tabindex="0" loading="lazy"><figcaption>image-20221201000512886</figcaption></figure><blockquote><p>After拦截器：AspectJAfterAdvice#invoke</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">// 后置执行方法总会被执行, 因为在finally中</span>
        <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span><span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里很特殊，看到After拦截器先继续调用拦截器链，然后再finally中执行具体的增强器逻辑。</p><h4 id="第五次调用" tabindex="-1"><a class="header-anchor" href="#第五次调用" aria-hidden="true">#</a> 第五次调用</h4><p>此时程序第五次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为4</strong>，取出拦截器链第五个拦截器<strong>AfterReturningAdviceInterceptor</strong>，Step Into进入invoke方法。</p><figure><img src="/assets/image202212262226612-09d150ad.png" alt="image-20221201000857402" tabindex="0" loading="lazy"><figcaption>image-20221201000857402</figcaption></figure><blockquote><p>返回拦截器：AfterReturningAdviceInterceptor#invoke</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行下一个拦截器</span>
    <span class="token class-name">Object</span> retVal <span class="token operator">=</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回目标方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>advice<span class="token punctuation">.</span><span class="token function">afterReturning</span><span class="token punctuation">(</span>retVal<span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里也是先执行下一个拦截器</p><h4 id="第六次调用" tabindex="-1"><a class="header-anchor" href="#第六次调用" aria-hidden="true">#</a> 第六次调用</h4><p>此时程序第六次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为5</strong>，取出拦截器链第六个拦截器<strong>AspectJAfterThrowingAdvice</strong>，Step Into进入invoke方法。</p><figure><img src="/assets/image202212262226653-4ccf0f2b.png" alt="image-20221201001116931" tabindex="0" loading="lazy"><figcaption>image-20221201001116931</figcaption></figure><blockquote><p>抛出异常拦截器：AspectJAfterThrowingAdvice#invoke</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行下一个拦截器</span>
        <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 抛出异常</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldInvokeOnThrowing</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 执行异常通知</span>
            <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span><span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里也是先执行下一个拦截器</p><h4 id="第七次调用" tabindex="-1"><a class="header-anchor" href="#第七次调用" aria-hidden="true">#</a> 第七次调用</h4><p>此时程序第七次执行<strong>ReflectiveMethodInvocation</strong>的<strong>poceed</strong>方法，<strong>currentInterceptorIndex值为5</strong>，开始调用目标函数。</p><blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Object interceptorOrInterceptionAdvice = this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex);
因为上面是++currentInterceptorIndex，currentInterceptorIndex会先加一，再获取拦截器，所以第7次调用的时候，还没有走到这里来，currentInterceptorIndex还是上次调用的5.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><figure><img src="/assets/image202212262226820-f7cb0709.png" alt="image-20221201001403211" tabindex="0" loading="lazy"><figcaption>image-20221201001403211</figcaption></figure><p>此时，控制台输出如下：</p><figure><img src="/assets/image202212262226172-f485fb9d.png" alt="image-20221201001841006" tabindex="0" loading="lazy"><figcaption>image-20221201001841006</figcaption></figure><h4 id="退栈调用" tabindex="-1"><a class="header-anchor" href="#退栈调用" aria-hidden="true">#</a> 退栈调用</h4><p>随着<strong>invokeJoinpoint</strong>目标方法执行的成功，程序会返回到<strong>AspectJAfterThrowingAdvice</strong>的<strong>invoke</strong>方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里没问题的话，方法执行结束，出栈，有问题的话跳转到catch</span>
        <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 抛出异常</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldInvokeOnThrowing</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 执行异常通知</span>
            <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span><span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就这个例子来说，<strong>div</strong>方法没有抛出异常，所以<strong>AspectJAfterThrowingAdvice</strong>的<strong>invoke</strong>方法执行结束后出栈，程序回到<strong>AfterReturningAdviceInteceptor</strong>的<strong>invoke</strong>方法：</p><figure><img src="/assets/image202212262227085-9acdb516.png" alt="image-20221201002457913" tabindex="0" loading="lazy"><figcaption>image-20221201002457913</figcaption></figure><p><strong>this.advice.afterReturning</strong>执行<strong>afterReturning</strong>增强方法，控制台打印如下：</p><figure><img src="/assets/image202212262227748-263f65ab.png" alt="image-20221201002616357" tabindex="0" loading="lazy"><figcaption>image-20221201002616357</figcaption></figure><p><strong>AfterReturningAdviceInteceptor</strong>的<strong>invoke</strong>方法执行结束出栈，程序回到<strong>AspectJAfterAdvice</strong>的<strong>invoke</strong>方法：</p><figure><img src="/assets/image202212262227326-5edd1c79.png" alt="image-20221201002733843" tabindex="0" loading="lazy"><figcaption>image-20221201002733843</figcaption></figure><p><strong>AspectJAfterAdvice</strong>的<strong>invoke</strong>方法最终执行<strong>finally 的 after 逻辑</strong>，控制台打印内容如下：</p><figure><img src="/assets/image202212262227869-ea8a7ed0.png" alt="image-20221201002817304" tabindex="0" loading="lazy"><figcaption>image-20221201002817304</figcaption></figure><p><strong>AspectJAfterAdvice</strong>的<strong>invoke</strong>方法执行结束出栈，程序回到<strong>MethodBeforeAdviceInterceptor</strong>的<strong>invoke</strong>方法：</p><figure><img src="/assets/image202212262227446-4c6edd5c.png" alt="image-20221201002914734" tabindex="0" loading="lazy"><figcaption>image-20221201002914734</figcaption></figure><p><strong>MethodBeforeAdviceInterceptor</strong>的<strong>invoke</strong>方法正常执行结束，程序回到<strong>MethodInvocationProceedingJoinPoint</strong>的<strong>process</strong>，<strong>MethodInvocationProceedingJoinPoint</strong>类实现了<strong>ProceedingJoinPoint</strong>接口，所以这里就开始执行**@Around**增强方法里面的目标方法了。</p><figure><img src="/assets/image202212262227868-f0f818bc.png" alt="image-20221201003005266" tabindex="0" loading="lazy"><figcaption>image-20221201003005266</figcaption></figure><p>开始执行<strong>logAround</strong>里面的方法，此时可以看到是从**joinPoint.proceed()**方法处返回的：</p><figure><img src="/assets/image202212262227660-db1c30d7.png" alt="image-20221201003140578" tabindex="0" loading="lazy"><figcaption>image-20221201003140578</figcaption></figure><p>控制台打印：</p><figure><img src="/assets/image202212262227405-c25dbb5d.png" alt="image-20221201003212782" tabindex="0" loading="lazy"><figcaption>image-20221201003212782</figcaption></figure><p><strong>@Around</strong>增强方法执行完成后，会退出堆栈，程序回到<strong>ExposeInvocationInterceptor</strong>的<strong>invoke</strong>方法：</p><figure><img src="/assets/image202212262227998-15125e38.png" alt="image-20221201003350133" tabindex="0" loading="lazy"><figcaption>image-20221201003350133</figcaption></figure><p><strong>ExposeInvocationInterceptor</strong>的<strong>invoke</strong>方法执行结束出栈，程序回到<strong>CglibAopProxy</strong>的<strong>intercept</strong>方法：</p><figure><img src="/assets/image202212262227564-ba232a2e.png" alt="image-20221201003516164" tabindex="0" loading="lazy"><figcaption>image-20221201003516164</figcaption></figure><p><strong>CglibAopProxy</strong>的<strong>intercept</strong>方法执行结束出栈后，整个AOP的拦截器链调用也随之结束了：</p><figure><img src="/assets/image202212262227508-0969cfb6.png" alt="image-20221201003552035" tabindex="0" loading="lazy"><figcaption>image-20221201003552035</figcaption></figure></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Floweryu/floweryu.github.io/edit/main/src/spring/Spring的动态AOP原理.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a aria-label="Spring中Bean的作用域" class="vp-link nav-link prev nav-link prev" href="/spring/Spring%E4%B8%ADBean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9Fscope.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Spring中Bean的作用域</div></a><a aria-label="Spring如何解决循环依赖" class="vp-link nav-link next nav-link next" href="/spring/Spring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Spring如何解决循环依赖<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright © 2024 Floweryu</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-3981ffce.js" defer></script>
  </body>
</html>
