(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{454:function(a,t,s){"use strict";s.r(t);var l=s(2),e=Object(l.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("blockquote",[t("p",[a._v("在进行分页查询的时候，通常会使用LIMIT加偏移量的办法实现，但当偏移量非常大的时候，例如：LIMIT 10000， 20这样的查询，这是MySQL需要查询10020条记录然后只返回20条，前面的10000条都将会抛弃。这样的代价就非常高。")])]),a._v(" "),t("p",[a._v("优化上述查询，有两种方案供选择：")]),a._v(" "),t("ul",[t("li",[a._v("在页面中限制分页的数量")]),a._v(" "),t("li",[a._v("优化大偏移量的性能")])]),a._v(" "),t("p",[t("strong",[a._v("使用索引覆盖扫描，不查询所有的列，然后根据需要进行一次关联，再返回所需的列")])]),a._v(" "),t("p",[a._v("例如下面查询：")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT film_id, description FROM sakila.film ORDER BY title LIMIT 50, 5;\n")])])]),t("p",[a._v("当偏移量很大的时候，可以改成下面查询：")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT film.film_id, film.description FROM sakila.film INNER JOIN (\n\tSELECT film_id FROM sakila.film ORDER BY title LIMIT 50, 5\n) AS lim USING(film_id);\n")])])]),t("p",[a._v("这里先获取需要访问的记录，然后再根据关联列回原表查询所需要的列。")]),a._v(" "),t("hr"),a._v(" "),t("p",[t("strong",[a._v("将LIMIT查询转换为已知位置的查询，让MySQL通过范围扫描获得到对应的结果")])]),a._v(" "),t("p",[a._v("可以根据索引列，预先计算边界值，上面查询可以修改为：")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT film_id, description FROM sakila.film\nWHERE position BETWEEN 50 AND 54 ORDER BY position;\n")])])]),t("hr"),a._v(" "),t("blockquote",[t("p",[a._v("LIMIT和OFFSET的问题，实际上是OFFSET的问题，它会导致MySQL扫描大量不需要的行然后再抛弃掉。")])]),a._v(" "),t("p",[t("strong",[a._v("可以使用标记记录上次读取数据的位置，下次就可以直接从该标记的位置开始扫描，这样可以避免OFFSET")])]),a._v(" "),t("p",[a._v("假设使用下面查询获取第一条结果：")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT * FROM sakila.rental\nORDER BY rental_id DESC LIMIT 20;\n")])])]),t("p",[a._v("假设上面查询的是主键16049到16030的租界记录，下一页查询就可以从16030这个点开始")]),a._v(" "),t("div",{staticClass:"language-mysql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("SELECT * FROM sakila.rental\nWHERE rental_id < 16030\nORDER BY rental_id DESC LIMIT 2\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);